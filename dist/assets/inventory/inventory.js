/* Slot Inventory, Ver.0.1.15, Fork from simple-inventory */
/// Build Date: 2025-06-12T20:25:42.840Z
(()=>{function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,n(i.key),i)}}function n(e){var n=function(e,n){if("object"!=t(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,n||"default");if("object"!=t(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==t(n)?n:n+""}function r(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}!function(t){"use strict";var i,a,o,s=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return n=t,a=[{key:"info",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e3;return r(t,this,l).call(this,e,n,i,"info"),this}},{key:"success",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e3;return r(t,this,l).call(this,e,n,i,"success"),this}},{key:"warn",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e3;return r(t,this,l).call(this,e,n,i,"warn"),this}},{key:"error",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e3;return r(t,this,l).call(this,e,n,i,"error"),this}},{key:"debug",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e3;return r(t,this,l).call(this,e,n,i,"debug"),this}}],(i=null)&&e(n.prototype,i),a&&e(n,a),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,i,a}();function l(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e3,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"info";e=e||"请输入标题",r(t,this,c)._||(c._=r(t,this,new t)),r(t,this,d)._.push({title:e,content:n,duration:i,type:a}),r(t,this,f)._||r(t,this,u).call(this)}function u(){if(0!==r(t,this,d)._.length){f._=r(t,this,!0);var e=r(t,this,d)._.shift(),n=e.title,i=e.content,a=e.duration,o=e.type,s=$("<div>").addClass("custom-popup popup-".concat(o)).toggleClass("dark-mode",this.darkMode).append($("<div>").addClass("popup-progress"),$("<div>").addClass("popup-close").text("×"),$("<div>").addClass("popup-title").text(n),i?$("<div>").addClass("popup-content").html(i):null).appendTo(document.body),l=s.find(".popup-progress"),c=null,h=!1,v=a,p=!1,m=null;requestAnimationFrame((function(){s.addClass("show"),C()})),s.hover((function(){h=!0,I()}),(function(){h=!1,w()}));var y=function(){document.hidden?(p=!h,h||(h=!0,I())):p&&(h=!1,w())};$(document).on("visibilitychange",y);var g=function(){$(document).off("visibilitychange",y)};s.find(".popup-close").click((function(){g(),x()}));var b=x;x=function(){g(),b()}}else f._=r(t,this,!1);function S(t){if(!m)return m=t,requestAnimationFrame(S);if(!h){var e=t-m,n=1-(v=Math.max(0,v-e))/a,r=Math.max(0,100*(1-n));l.css("transform","translateX(-".concat(100-r,"%)")),v>0?(m=t,c=requestAnimationFrame(S)):x()}}function C(){h||(m=null,c=requestAnimationFrame(S))}function I(){c&&(cancelAnimationFrame(c),c=null,m=null)}function w(){h||C()}function x(){c&&(cancelAnimationFrame(c),c=null),s.removeClass("show"),setTimeout((function(){s.remove(),u.call(t)}),400)}}t=s,i=s,o=!0,(a=n(a="darkMode"))in i?Object.defineProperty(i,a,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[a]=o;var c={_:null},d={_:[]},f={_:!1};setup.Popup=s,window.Popup=window.Popup||s}()})(),(()=>{function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,a,o,s=[],l=!0,u=!1;try{if(a=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=a.call(n)).done)&&(s.push(r.value),s.length!==e);l=!0);}catch(t){u=!0,i=t}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw i}}return s}}(t,e)||r(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=r(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,a=function(){};return{s:a,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){l=!0,o=t},f:function(){try{s||null==n.return||n.return()}finally{if(l)throw o}}}}function r(t,e){if(t){if("string"==typeof t)return i(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(t,e):void 0}}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function a(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,o(r.key),r)}}function o(e){var n=function(e,n){if("object"!=t(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,n||"default");if("object"!=t(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==t(n)?n:n+""}function s(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}!function(t){"use strict";var r=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return r=t,c=[{key:"init",value:function(){s(t,this,l)._||(this.addMain("equipment","装备",100),this.addSub("equipment","weapon","武器",110),this.addSub("equipment","armor","护甲",120),this.addSub("equipment","accessory","饰品",130),this.addMain("consumable","消耗品",200),this.addSub("consumable","potion","药水",210),this.addSub("consumable","scroll","卷轴",220),this.addSub("consumable","food","食物",230),this.addMain("material","材料",300),this.addSub("material","quest","任务材料",310),this.addSub("material","ore","矿石",320),this.addSub("material","herb","草药",330),this.addSub("material","wood","木材",340),this.addSub("material","hide","兽皮",350),this.addSub("material","bone","骨头",360),this.addSub("material","gem","宝石",370),this.addSub("material","metal","金属",380),this.addSub("material","cloth","布料",390),this.addMain("misc","其他",900),this.addSub("misc","quest","任务物品",910),l._=s(t,this,!0))}},{key:"addMain",value:function(e,n,r){if("string"!=typeof e||"string"!=typeof n||"number"!=typeof r)throw new TypeError("Invalid parameter types for addMain");return e=e.toLowerCase(),s(t,this,i)._.has(e)?(console.warn("主分类 ".concat(e," 已存在")),!1):(s(t,this,i)._.set(e,{id:e,name:n,order:r,subCategories:new Map}),this.addSub(e,"other","其他".concat(n),r+99),!0)}},{key:"addSub",value:function(e,n,r,a){if("string"!=typeof e||"string"!=typeof n||"string"!=typeof r||"number"!=typeof a)throw new TypeError("Invalid parameter types for addSub");e=e.toLowerCase(),n=n.toLowerCase();var l=s(t,this,i)._.get(e);if(!l)return console.warn("主分类 ".concat(e," 不存在")),!1;var u="".concat(e,".").concat(n);if(s(t,this,o)._.has(u))return console.warn("子分类 ".concat(u," 已存在")),!1;var c={id:n,fullId:u,name:r,order:a,mainCategory:e};return l.subCategories.set(n,c),s(t,this,o)._.set(u,c),!0}},{key:"getMain",value:function(e){return"string"!=typeof e?null:s(t,this,i)._.get(e.toLowerCase())||null}},{key:"getSub",value:function(e,n){return"string"!=typeof e||"string"!=typeof n?null:s(t,this,o)._.get("".concat(e.toLowerCase(),".").concat(n.toLowerCase()))||null}},{key:"getMainBySubId",value:function(e){var n=s(t,this,o)._.get(e.toLowerCase());return n?this.getMain(n.mainCategory):null}},{key:"getOrder",value:function(e){var n=s(t,this,o)._.get(e.toLowerCase());return n?n.order:1/0}},{key:"getAllMain",value:function(){return new Map(s(t,this,i)._)}},{key:"getSubs",value:function(t){var e=this.getMain(t);return e?e.subCategories:new Map}},{key:"exists",value:function(e){return s(t,this,o)._.has(e.toLowerCase())}},{key:"validate",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return"string"==typeof t&&!!this.getMain(t)&&(null===e||"string"==typeof e&&null!==this.getSub(t,e))}},{key:"category",value:function(r){if("string"!=typeof r)throw new TypeError("分类必须是字符串类型");if(r=r.toLowerCase(),this.getMain(r))return[r,"other"];var a,o=n(s(t,this,i)._);try{for(o.s();!(a=o.n()).done;){var l=e(a.value,2),u=l[0];if(l[1].subCategories.has(r))return[u,r]}}catch(t){o.e(t)}finally{o.f()}throw new Error("未知的物品类型: ".concat(r))}},{key:"getAllCategories",value:function(){var r,a=new Map,o=n(s(t,this,i)._.keys());try{for(o.s();!(r=o.n()).done;){var l=r.value;a.set(l,(a.get(l)||0)+1);var u,c=n(this.getSubs(l).keys());try{for(c.s();!(u=c.n()).done;){var d=u.value;"other"!==d&&a.set(d,(a.get(d)||0)+1)}}catch(t){c.e(t)}finally{c.f()}}}catch(t){o.e(t)}finally{o.f()}var f,h=[],v=n(a);try{for(v.s();!(f=v.n()).done;){var p=e(f.value,2),m=p[0];1===p[1]&&h.push(m)}}catch(t){v.e(t)}finally{v.f()}return Object.freeze(h)}}],(u=null)&&a(r.prototype,u),c&&a(r,c),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,u,c}();t=r;var i={_:new Map},o={_:new Map},l={_:!1};t.init(),setup.ItemCategory=r,window.ItemCategory=window.ItemCategory||r,setup.category=function(t){return r.category(t)},setup.validateCategory=function(t,e){return r.validate(t,e)},setup.AllCategories=r.getAllCategories(),window.category=window.category||setup.category,window.validateCategory=window.validateCategory||setup.validateCategory,window.AllCategories=window.AllCategories||setup.AllCategories}()})(),(()=>{function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,n(i.key),i)}}function n(e){var n=function(e,n){if("object"!=t(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,n||"default");if("object"!=t(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==t(n)?n:n+""}!function(){"use strict";var r,i,a,o={url:"",description:"",handler:null,displayName:"",unique:!1,permanent:!1,stackable:!1,durability:0,cat:"misc",sub:"other",order:0},s=new Map,l=function(){function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:clone(o),i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n),!e||"string"!=typeof e)throw new Error("invalid item ID");if("object"!==t(r))throw new Error("invalid item definition");if(Object.assign(this,Object.assign({},o,r)),this.cat=this.cat.toLowerCase(),this.sub=this.sub.toLowerCase(),!ItemCategory.validate(this.cat,this.sub))throw new Error("Invalid item category: ".concat(this.cat,".").concat(this.sub));this.id=e,this._tags=i instanceof Array?i:"string"==typeof i?[i]:[]}return r=n,i=[{key:"name",get:function(){return this.displayName||this.id},set:function(t){this.displayName=t}},{key:"tags",get:function(){return this._tags}},{key:"hasTag",value:function(t){return this._tags.includes(t)}},{key:"hasAllTags",value:function(){return this._tags.includesAll([].slice.call(arguments).flat(1/0))}},{key:"hasAnyTags",value:function(){return this._tags.includesAny([].slice.call(arguments).flat(1/0))}},{key:"use",value:function(){return"function"==typeof this.handler?this.handler(this):"string"==typeof this.handler&&$.wiki(this.handler),this}},{key:"inspect",value:function(){return Dialog.create(this.name,"simple-inventory item-description").wiki(this.description).open(),this}},{key:"compare",value:function(t){if(!(t instanceof n))return 0;var e=ItemCategory.getOrder("".concat(this.cat,".").concat(this.sub)),r=ItemCategory.getOrder("".concat(t.cat,".").concat(t.sub));return e!==r?e-r:this.order!==t.order?this.order-t.order:(this.displayName||this.id).localeCompare(t.displayName||t.id)}}],a=[{key:"is",value:function(t){return t instanceof n}},{key:"add",value:function(t,e,r){var i=new n(t,e,r);return s.set(t,i),i}},{key:"get",value:function(t){return s.get(t)}},{key:"has",value:function(t){return s.has(t)}},{key:"filter",value:function(t){return Array.from(s.values()).filter(t)}},{key:"list",get:function(){return s}},{key:"compare",value:function(t,e){return t.compare(e)}}],i&&e(r.prototype,i),a&&e(r,a),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,i,a}();r=l,i="DefaultItem",a=new l("Other",{cat:"misc",sub:"other",stackable:!0,permanent:!1,durability:0,displayName:"未知物品"}),(i=n(i))in r?Object.defineProperty(r,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):r[i]=a,setup.Item=l,window.Item=window.Item||l}()})(),(()=>{function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return n(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var i=0,a=function(){};return{s:a,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return s=t.done,t},e:function(t){l=!0,o=t},f:function(){try{s||null==r.return||r.return()}finally{if(l)throw o}}}}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,o(r.key),r)}}function i(t,e){(function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")})(t,e),e.add(t)}function a(t,e,n){return(e=o(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function o(e){var n=function(e,n){if("object"!=t(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,n||"default");if("object"!=t(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==t(n)?n:n+""}function s(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}!function(t,n){"use strict";var o=new WeakSet,l=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:clone(t.DefaultOpts),a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),i(this,o),this.slots=Array.isArray(e)&&e.length>0?clone(e):new Array(r.maxSlots).fill(null),this.items=clone(n),this.opts=r,this._tags=a instanceof Array?a:"string"==typeof a?a.split(" "):[],s(o,this,u).call(this)}return n=t,a=[{key:"store",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],l=this.items[e];if(n<=0)return s(o,this,c).call(this,r,e,t.StatusCode.INVALID_ITEM_COUNT);if(null!==r){if(r>=this.maxSlots||this.slots[r]&&this.slots[r].id!==e)return s(o,this,c).call(this,r,e,t.StatusCode.INVALID_SLOT);var u=s(o,this,f).call(this,e,n,r,i);if(0===u)return s(o,this,c).call(this,r,e,t.StatusCode.SUCCESS);n=u}if(l)for(var d=0;d<l.idx.length;d++){var h=l.idx[d],v=s(o,this,f).call(this,e,n,h,i);if(0===v)return s(o,this,c).call(this,r,e,t.StatusCode.SUCCESS);n=v}for(;n>0;){var p=this.emptySlot;if(-1===p){var m=t.handlers[":inventory_full"];State.length<=0&&a&&Popup.warn("背包已满","".concat(e,"(x").concat(n,")被丢弃")),m&&m(e,n);var y=s(o,this,c).call(this,null,e,t.StatusCode.SLOT_FULL);return y.drop=n,y}var g=s(o,this,f).call(this,e,n,p,i);if(0===g)return s(o,this,c).call(this,p,e,t.StatusCode.SUCCESS);n=g}return s(o,this,c).call(this,emptySlot,e,t.StatusCode.SUCCESS)}},{key:"iterate",value:function(t){if("function"==typeof t)for(var e=0;e<this.slots.length;e++){var n=this.slots[e];t(e,n,n?this.items[n.id]:null)}}},{key:"drop",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(e>=this.maxSlots)return s(o,this,c).call(this,null,null,t.StatusCode.INVALID_SLOT);var r=this.slots[e];if(!r)return s(o,this,c).call(this,e,null,t.StatusCode.INVALID_SLOT);var i=Item.get(r.id);if(null!=i&&i.permanent)return s(o,this,c).call(this,e,r.id,t.StatusCode.PERMANENT_ITEM);var a=-1===n?r.count:Math.min(n,r.count),l=this.items[r.id],u=l.idx.indexOf(e);return a>=r.count?(l.idx.splice(u,1),l.num.splice(u,1),this.slots[e]=null,0===l.idx.length&&delete this.items[r.id]):(r.count-=a,l.num[u]=r.count),s(o,this,c).call(this,e,r.id,t.StatusCode.SUCCESS)}},{key:"transfer",value:function(e,n){var r,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(n>=this.maxSlots||i>=e.maxSlots)return s(o,this,c).call(this,null,null,t.StatusCode.INVALID_SLOT);var a=this.slots[n];if(!a)return s(o,this,c).call(this,n,null,t.StatusCode.INVALID_SLOT);var l,u=a.id,d=a.count,f=a.durability;return(l=null!==(r=Item.get(u))&&void 0!==r&&r.permanent?s(o,this,c).call(this,n,u,t.StatusCode.PERMANENT_ITEM):e.store(u,d,i,f,!1)).code===t.StatusCode.SUCCESS?this.drop(n,d):l.code===t.StatusCode.INVENTORY_FULL&&this.drop(n,d-l.drop),l}},{key:"move",value:function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(e>=this.maxSlots||n>=this.maxSlots)return s(o,this,c).call(this,n,null,t.StatusCode.INVALID_SLOT);var i=this.slots[e],a=this.slots[n];if(!i)return s(o,this,c).call(this,n,null,t.StatusCode.EMPTY_SLOT);if(r=null===r?i.count:Math.min(r,i.count),!a){if(this.slots[n]={id:i.id,count:r,durability:i.durability},r===i.count){this.slots[e]=null;var l=this.items[i.id],u=l.idx.indexOf(e);l.idx[u]=n}else{i.count-=r;var d=this.items[i.id];d.idx.push(n),d.num.push(r);var f=d.idx.indexOf(e);d.num[f]=i.count}return s(o,this,c).call(this,n,i.id,t.StatusCode.SUCCESS)}var h=Item.get(i.id);if(i.id===a.id&&(null!=h&&h.stackable||!h)){var v=this.maxStack-a.count,p=Math.min(r,v);if(p>0){a.count+=p,i.count-=p;var m=this.items[i.id],y=m.idx.indexOf(e),g=m.idx.indexOf(n);m.num[g]=a.count,m.num[y]=i.count,0===i.count&&(this.slots[e]=null,m.idx.splice(y,1),m.num.splice(y,1))}}else{var b=this.items[i.id],S=this.items[a.id],C=b.idx.indexOf(e),I=S.idx.indexOf(n);b.idx[C]=n,b.num[C]=a.count,S.idx[I]=e,S.num[I]=i.count,this.slots[e]=a,this.slots[n]=i}return s(o,this,c).call(this,n,i.id,t.StatusCode.SUCCESS)}},{key:"sort",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this.slots.map((function(t,e){return{slot:t,idx:e}})).filter((function(e){var n=e.slot,r=e.idx;return n&&!t.includes(r)})),i=this.slots.map((function(t,e){return{slot:t,idx:e}})).filter((function(e){var n=e.slot,r=e.idx;return n&&t.includes(r)}));if(n){var a,o={},s=e(r);try{for(s.s();!(a=s.n()).done;){var l=a.value.slot,u=Item.get(l.id);(null!=u&&u.stackable||!u)&&(o[l.id]||(o[l.id]=[]),o[l.id].push(l))}}catch(t){s.e(t)}finally{s.f()}var c=[];for(var d in o)for(var f=o[d].reduce((function(t,e){return t+e.count}),0),h=o[d][0].durability;f>0;){var v=Math.min(f,this.maxStack);c.push({slot:{id:d,count:v,durability:h},idx:-1}),f-=v}r.forEach((function(t){var e=t.slot,n=Item.get(e.id);null!=n&&n.stackable||!n||c.push({slot:e,idx:-1})})),r.length=0,r.push.apply(r,c)}r.sort((function(t,e){var n,r,i=Item.get(t.slot.id),a=Item.get(e.slot.id);return i||((i=clone(Item.DefaultItem)).name=t.slot.id),a||((a=clone(Item.DefaultItem)).name=e.slot.id),(null===(n=(r=i).compare)||void 0===n?void 0:n.call(r,a))||0}));var p=new Array(this.maxSlots).fill(null),m={};i.forEach((function(t){var e=t.slot,n=t.idx;p[n]=e;var r=e.id;m[r]?(m[r].idx.push(n),m[r].num.push(e.count)):m[r]={idx:[n],num:[e.count]}}));var y=0;return r.forEach((function(e){for(var n=e.slot;t.includes(y);)y++;p[y]=n;var r=n.id;m[r]?(m[r].idx.push(y),m[r].num.push(n.count)):m[r]={idx:[y],num:[n.count]},y++})),this.slots=p,this.items=m,!0}},{key:"split",value:function(e,n){if(e>=this.maxSlots)return s(o,this,c).call(this,null,null,t.StatusCode.INVALID_SLOT);var r=this.slots[e];if(!r)return s(o,this,c).call(this,e,null,t.StatusCode.INVALID_SLOT);if(n>=r.count)return s(o,this,c).call(this,e,r.id,t.StatusCode.INVALID_NUMBER);var i=this.emptySlot;if(-1===i)return s(o,this,c).call(this,e,r.id,t.StatusCode.INVENTORY_FULL);var a={id:r.id,count:n};r.durability&&(a.durability=r.durability),r.count-=n;var l=this.items[r.id],u=l.idx.findIndex((function(t){return t===e}));return l.num[u]-=n,l.idx.push(i),l.num.push(n),this.slots[i]=a,s(o,this,c).call(this,e,r.id,t.StatusCode.SUCCESS)}},{key:"delete",value:function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];if(0===(n=n.flat(1/0)).length)return s(o,this,c).call(this,null,null,t.StatusCode.INVALID_ARGS);n.length%2!=0&&n.push(1);for(var i=0;i<n.length;i+=2){var a=n[i],l=n[i+1];if("string"!=typeof a||"number"!=typeof l||l<=0)return s(o,this,c).call(this,null,a,t.StatusCode.INVALID_ARGS);var u=s(o,this,d).call(this,a,l);if(!u.success)return u}return s(o,this,c).call(this,null,null,t.StatusCode.SUCCESS)}},{key:"use",value:function(e){if(e>=this.maxSlots)return s(o,this,c).call(this,null,null,t.StatusCode.INVALID_SLOT);var n=this.slots[e];if(!n)return s(o,this,c).call(this,e,null,t.StatusCode.INVALID_SLOT);var r=Item.get(n.id);if(!r)return s(o,this,c).call(this,e,n.id,t.StatusCode.INVALID_ITEM);var i={item:r,slot:n,index:e,inv:this,cancel:!1};if(triggerEvent(":item_pre_use",document,{detail:i}),i.cancel)return s(o,this,c).call(this,e,n.id,t.StatusCode.CANCELLED);if(r.use(),r.durability>=1){if(n.durability--,n.durability<=0)return this.drop(e,1)}else if(ItemCategory.validate("consumable"))return this.drop(e,1);return triggerEvent(":item_post_use",document,{detail:i}),s(o,this,c).call(this,e,n.id,t.StatusCode.SUCCESS)}},{key:"indexOf",value:function(t){var e,n;return null!==(e=null===(n=this.items[t])||void 0===n?void 0:n.idx[0])&&void 0!==e?e:-1}},{key:"addDur",value:function(e,n){if(e>=this.maxSlots)return s(o,this,c).call(this,null,null,t.StatusCode.INVALID_SLOT);var r=this.slots[e];if(!r)return s(o,this,c).call(this,e,null,t.StatusCode.INVALID_SLOT);var i=Item.get(r.id);return!i||i.durability<=0?s(o,this,c).call(this,e,r.id,t.StatusCode.INVALID_ITEM):(r.durability=Math.min(i.durability,r.durability+n),s(o,this,c).call(this,e,r.id,t.StatusCode.SUCCESS))}},{key:"subDur",value:function(e,n){if(e>=this.maxSlots)return s(o,this,c).call(this,null,null,t.StatusCode.INVALID_SLOT);var r=this.slots[e];if(!r)return s(o,this,c).call(this,e,null,t.StatusCode.INVALID_SLOT);var i=Item.get(r.id);return!i||i.durability<=0?s(o,this,c).call(this,e,r.id,t.StatusCode.INVALID_ITEM):(r.durability=Math.max(0,r.durability-n),s(o,this,c).call(this,e,r.id,t.StatusCode.SUCCESS))}},{key:"setDur",value:function(e,n){if(e>=this.maxSlots)return s(o,this,c).call(this,null,null,t.StatusCode.INVALID_SLOT);var r=this.slots[e];if(!r)return s(o,this,c).call(this,e,null,t.StatusCode.INVALID_SLOT);var i=Item.get(r.id);return!i||i.durability<=0?s(o,this,c).call(this,e,r.id,t.StatusCode.INVALID_ITEM):(r.durability=Math.min(i.durability,Math.max(0,n)),s(o,this,c).call(this,e,r.id,t.StatusCode.SUCCESS))}},{key:"count",value:function(t){var e=this.items[t];return e?e.num.reduce((function(t,e){return t+e}),0):0}},{key:"canStack",value:function(t){return((null==t?void 0:t.stackable)||!t)&&!((null==t?void 0:t.durability)>0)}},{key:"isFull",get:function(){return-1===this.emptySlot}},{key:"emptySlot",get:function(){return this.slots.findIndex((function(t){return!t}))}},{key:"clone",value:function(){return new t(this.slots,this.items,this.opts,this._tags)}},{key:"toJSON",value:function(){return Serial.createReviver(String.format("new {0}({1},{2},{3},{4})","Inventory",JSON.stringify(this.slots),JSON.stringify(this.items),JSON.stringify(this.opts),JSON.stringify(this._tags)))}}],a&&r(n.prototype,a),l&&r(n,l),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,a,l}();function u(){var t=this;Object.keys(this.opts).forEach((function(e){Object.defineProperty(t,e,{get:function(){return this.opts[e]},set:function(t){this.opts[e]=t}})}))}function c(e,n,r){return{slot:e,item:n,success:r===t.StatusCode.SUCCESS,code:r,message:t.Messages[r]}}function d(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,r=this.items[e];if(!r)return s(o,this,c).call(this,null,e,t.StatusCode.INVALID_ITEM);for(var i=r.num.reduce((function(t,e){return t+e}),0),a=-1===n?i:Math.min(n,i),l=r.idx.length-1;l>=0&&a>0;l--){var u=r.idx[l],d=this.slots[u],f=Math.min(a,d.count);f>=d.count?(r.idx.splice(l,1),r.num.splice(l,1),this.slots[u]=null):(d.count-=f,r.num[l]=d.count),a-=f}return 0===r.idx.length&&delete this.items[e],s(o,this,c).call(this,null,e,t.StatusCode.SUCCESS)}function f(t,e,n,r){if(e<1)return e;var i=this.slots[n],a=Item.get(t);return i?i.id===t&&this.canStack(a)?s(o,this,v).call(this,t,e,n,i):e:s(o,this,h).call(this,t,e,n,a,r)}function h(t,e,n,r,i){if((null==r?void 0:r.durability)>0||null!=r&&(null==r||!r.stackable))return this.slots[n]={id:t,count:1,durability:(null==r?void 0:r.durability)>0?null!=i?i:r.durability:null},s(o,this,p).call(this,t,n,1),e-1;var a=Math.min(e,this.maxStack);return this.slots[n]={id:t,count:a,durability:null},s(o,this,p).call(this,t,n,a),e-a}function v(t,e,n,r){var i=this.maxStack-r.count,a=Math.min(e,i);r.count+=a;var o=this.items[t],s=o.idx.indexOf(n);return o.num[s]+=a,e-a}function p(t,e,n){if(this.items[t]){var r=this.items[t];r.idx.push(e),r.num.push(n)}else this.items[t]={idx:[e],num:[n]}}t=l,a(l,"handlers",{}),a(l,"DefaultOpts",{maxSlots:20,maxStack:64}),a(l,"StatusCode",Object.freeze({SUCCESS:100,SLOT_FULL:201,INVALID_SLOT:202,SLOT_OCCUPIED:203,INVALID_ITEM:204,PERMANENT_ITEM:205,INVALID_NUMBER:206,INVENTORY_FULL:207,INVALID_ITEM_COUNT:208,INVALID_ARGS:250,UNKNOWN_ERROR:299,CANCELLED:208})),a(l,"Messages",(a(a(a(a(a(a(a(a(a(a(n={},t.StatusCode.SUCCESS,"储存成功"),t.StatusCode.SLOT_FULL,"当前储存空间不足"),t.StatusCode.INVALID_SLOT,"无效的格子索引"),t.StatusCode.SLOT_OCCUPIED,"储存位置已被占用"),t.StatusCode.INVALID_ITEM,"无效的物品"),t.StatusCode.PERMANENT_ITEM,"该物品无法丢弃"),t.StatusCode.INVALID_NUMBER,"无效的数字"),t.StatusCode.INVENTORY_FULL,"背包已满"),t.StatusCode.INVALID_ITEM_COUNT,"无效的物品数量"),t.StatusCode.INVALID_ARGS,"无效的参数"),a(a(n,t.StatusCode.UNKNOWN_ERROR,"未知错误"),t.StatusCode.CANCELLED,"操作被取消"))),setup.Inventory=l,window.Inventory=window.Inventory||l}()})(),(()=>{function t(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=n(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var i=0,a=function(){};return{s:a,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return s=t.done,t},e:function(t){l=!0,o=t},f:function(){try{s||null==r.return||r.return()}finally{if(l)throw o}}}}function e(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,a,o,s=[],l=!0,u=!1;try{if(a=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=a.call(n)).done)&&(s.push(r.value),s.length!==e);l=!0);}catch(t){u=!0,i=t}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw i}}return s}}(t,e)||n(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(t,e){if(t){if("string"==typeof t)return r(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(t,e):void 0}}function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}!function(){"use strict";var n={90:"perfect",70:"high",50:"good",30:"medium",10:"poor",0:"low"},r=Object.entries(n).sort((function(t,n){var r=e(t,1)[0],i=e(n,1)[0];return Number(i)-Number(r)}));function i(i,a){var o,s=a+1,l=$("<div>").addClass("inv-slot").attr("data-slot",s);if(!i)return l.addClass("empty");var u=Item.get(i.id),c=(null==u?void 0:u.displayName)||i.id,d=u?"item-".concat(u.cat,"-").concat(u.sub):"";if(l.addClass(d).attr("data-id",i.id).attr("data-category","".concat((null==u?void 0:u.cat)||"misc",".").concat((null==u?void 0:u.sub)||"other")),null!=u&&null!==(o=u.url)&&void 0!==o&&o.trim()?l.addClass("slot-img").append($("<img>").attr("src",u.url)):$("<div>").addClass("item-name").text(c).appendTo(l),i.durability){var f=Math.round(i.durability/u.durability*100),h=function(i){var a,o=t(r);try{for(o.s();!(a=o.n()).done;){var s=e(a.value,2),l=s[0],u=s[1];if(i>=Number(l))return u}}catch(t){o.e(t)}finally{o.f()}return n[0]}(f);$("<div>").addClass("item-durability-container").append($("<div>").addClass("item-durability-bar ".concat(h)).css("width","".concat(f,"%")),$("<div>").addClass("item-durability-text").text("".concat(i.durability,"/").concat(u.durability))).appendTo(l)}else $("<div>").addClass("item-count").text("x".concat(i.count)).appendTo(l);return l}function a(t,e,n,r){$(".item-context-menu").remove();var i=$(".inventory-container").parent(),a=Item.get(e.id),o=t.slots.indexOf(e),s=$("<div>").addClass("item-context-menu").css({position:"fixed",left:Math.max(0,n),top:Math.max(0,r),zIndex:200200}),l=[{text:"穿戴",setup:function(){var n={append:!1,handler:null};return $(document).trigger({type:"inventory:menu.wear",source:"Slot Inventory",idx:o,inv:t,slot:e,detail:n}),!!n.append&&n.handler}},{text:"使用",condition:function(){return!(!a||"function"!=typeof a.handler&&("string"!=typeof a.handler||""===a.handler.trim()))},action:function(){return function(t,e,n){try{if(!t.slots[e])return;t.use(e),t.render(n[0])}catch(t){console.error("Error handling item use:",t)}}(t,o,i)}},{text:"检查",action:function(){return a?a.inspect():Dialog.create(e.id).wiki("普普通通的".concat(e.id)).open()}},{text:"拆分",condition:function(){return e.count>=2},action:function(){return d(t,e,i)}},{text:"丢弃",condition:function(){return!(null!=a&&a.permanent)},action:function(){t.drop(o,-1),t.render(i[0])}}];("ontouchstart"in window||navigator.maxTouchPoints>0)&&l.push({text:"移动到...",action:function(){var e=$("<div>").addClass("inventory-move-overlay").css({position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:200150}),n=$("<div>").addClass("move-hint").text("选择目标位置").css({position:"fixed",top:"10px",left:"50%",transform:"translateX(-50%)",padding:"8px 16px",zIndex:200201}),r=$('.inv-slot[data-slot="'.concat(o+1,'"]')).addClass("move-source");$("body").append(e).append(n),$(".inv-slot").one("touchstart click",(function(a){a.preventDefault(),a.stopPropagation();var s=$(this).data("slot")-1;s!==o&&(t.transfer(t,o,s),t.render(i[0])),e.remove(),n.remove(),r.removeClass("move-source")})),e.on("touchstart click",(function(){e.remove(),n.remove(),r.removeClass("move-source")}))}});var u=!1;return l.forEach((function(e,n){var r=$("<div>").addClass("menu-item").text(e.text),a=null,o=!0;e.setup?!1===(a=e.setup())?o=!1:null===a&&r.addClass("disabled"):e.condition&&(e.condition()||r.addClass("disabled")),r.hasClass("disabled")||r.on("touchstart click",(function(n){n.preventDefault(),n.stopPropagation(),a?(a(),t.render(i[0])):e.action&&e.action(),s.remove()})),o&&(s.append(r),!u&&n<l.length-1&&(s.append($("<div>").addClass("menu-separator")),u=!0))})),$("body").append(s),s.on("click",(function(t){return t.stopPropagation()})),setTimeout((function(){$(document).one("click",(function(t){$(t.target).closest(".item-context-menu").length||s.remove()}))}),100),s}function o(t){$(this).hasClass("empty")?t.preventDefault():(t.originalEvent.dataTransfer.setData("text/plain",$(this).data("slot")),$(this).addClass("dragging"))}function s(t){$(this).removeClass("dragging")}function l(t){t.preventDefault(),$(this).addClass("drag-over")}function u(t){$(this).removeClass("drag-over")}function c(t,e){t.preventDefault(),$(this).removeClass("drag-over");var n=parseInt(t.originalEvent.dataTransfer.getData("text/plain")),r=parseInt($(this).data("slot"));n!==r&&(e.move(n-1,r-1),e.render($(this).closest(".inventory-container").parent()[0]))}function d(t,e,n){var r=Math.floor(e.count/2);if(r>0){var i=t.slots.indexOf(e),a=t.split(i,r);a.success||Popup.error("拆分失败",a.message),t.render(n[0])}}function f(n,r){if("equipment"===r.containerType)return function(t){var e=$("<div>").addClass("equipment-container"),n=$("<div>").addClass("equipment-title").text("装备栏"),r=$("<div>").addClass("equipment-grid").append(t.slots.map((function(t,e){return i(t,e)})));return e.append(n).append(r)}(r);var f=$(".inventory-container"),h=f.find(".inv-search").val()||"",v=f.find(".inv-regex-toggle").text().includes("开"),p=f.find(".inv-filter").val()||"all",m=function(n){var r=$("<div>").addClass("inventory-container"),a=$("<div>").addClass("inventory-controls"),o=$("<div>").addClass("inv-buttons"),s=$("<input>",{class:"inv-search",type:"text",placeholder:"搜索物品..."}),l=$("<button>",{class:"inv-sort",text:"排序"}),u=$("<button>",{class:"inv-regex-toggle",text:"正则搜索: 关"}),c=$("<select>").addClass("inv-filter");$("<option>",{value:"all",text:"全部"}).appendTo(c);var d,f=t(ItemCategory.getAllMain());try{for(f.s();!(d=f.n()).done;){var h=e(d.value,2),v=h[0],p=h[1];$("<option>",{value:v,text:p.name}).appendTo(c)}}catch(t){f.e(t)}finally{f.f()}var m=$("<div>").addClass("inventory-grid").append(n.slots.map((function(t,e){return i(t,e)})));return o.append(l).append(u).append(c),a.append(s).append(o),r.append(a).append(m)}(r);m.find(".inv-search").val(h),m.find(".inv-regex-toggle").text("正则搜索: ".concat(v?"开":"关")),m.find(".inv-filter").val(p),m.find(".inv-regex-toggle").on("click",(function(){v=!v,$(this).text("正则搜索: ".concat(v?"开":"关")),m.find(".inv-search").trigger("input")})),m.find(".inv-search").on("input",(function(){var t=$(this).val().toLowerCase(),n=m.find(".inv-filter").val();m.find(".inv-slot").each((function(){var r=$(this),i=r.find(".item-name").text().toLowerCase(),a=e((r.attr("data-category")||"misc.other").split("."),1)[0],o=!1;o="all"===n||a===n;var s=!1;if(v&&t)try{s=new RegExp(t,"i").test(i)}catch(t){s=!1}else s=i.includes(t)||""===t;r[o&&s?"show":"hide"]()}))})),m.find(".inv-sort").on("click",(function(){r.sort([],!0),r.render($(".inventory-container").parent()[0])})),m.find(".inv-filter").on("change",(function(){m.find(".inv-search").trigger("input")})),m.find(".inv-slot").each((function(){var t=$(this);if("ontouchstart"in window){var e=0,n=0,i=0,f=!1;t.on("touchstart",(function(t){var o=this;if($(this).hasClass("empty")||t.cancelable&&t.preventDefault(),t.stopPropagation(),!$(this).hasClass("empty")){var s=t.originalEvent.touches[0];e=Date.now(),n=s.clientX,i=s.clientY,f=!1,$(this).data("touchTimer",setTimeout((function(){var t=$(o).data("slot"),e=r.slots[t-1];e&&a(r,e,s.clientX,s.clientY)}),500))}})).on("touchmove",(function(t){!$(this).hasClass("empty")&&f&&t.cancelable&&t.preventDefault();var e=t.originalEvent.touches[0],r=Math.abs(e.clientX-n),a=Math.abs(e.clientY-i);(r>10||a>10)&&(f=!0,clearTimeout($(this).data("touchTimer")))})).on("touchend touchcancel",(function(t){if(clearTimeout($(this).data("touchTimer")),!f&&Date.now()-e<500){var n=$(this).data("slot"),i=r.slots[n-1];if(i){var a=Item.get(i.id);null==a||a.inspect()}}}))}else t.on("click contextmenu",(function(t){t.preventDefault();var e=$(this).data("slot");!function(t,e,n){var r=t.slots[e-1];if(r)if("ontouchstart"in window||navigator.maxTouchPoints>0){var i=n.type.includes("touch")?n.originalEvent.changedTouches[0]:n;a(t,r,i.clientX,i.clientY)}else if(n.shiftKey&&0===n.button){var o=Item.get(r.id);null==o||o.inspect()}else n.shiftKey&&2===n.button?(n.preventDefault(),n.stopPropagation(),d(t,r,$(n.target).closest(".inventory-container").parent())):2===n.button&&(n.preventDefault(),n.stopPropagation(),a(t,r,n.clientX,n.clientY))}(r,e,t)})).attr("draggable",!0).on("dragstart",o).on("dragend",s).on("dragover",l).on("dragleave",u).on("drop",(function(t){c.call(this,t,r)}))})),m.on("contextmenu",(function(t){t.preventDefault()})),h&&m.find(".inv-search").trigger("input"),"all"!==p&&m.find(".inv-filter").trigger("change"),$(n).empty().append(m)}Inventory.prototype.render=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;e?function(t,e,n,r){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("take"===r&&!i){var a=e;i=!0,e=n,n=a}var o=$("<div>").addClass("inventory-transfer-container"),s=$("<ul>").addClass("transfer-table");e.iterate((function(t,a,o){if(a){var l,u=Item.get(a.id);l="function"==typeof(null==u?void 0:u.inspect)?$("<a>").addClass("item-link").text((null==u?void 0:u.displayName)||a.id).on("click",(function(){var t;return null===(t=Item.get(a.id))||void 0===t?void 0:t.inspect()})):$("<span>").addClass("transfer-name").text((null==u?void 0:u.displayName)||a.id);var c=$("<li>").addClass("slot-inventory-listing").attr("data-slot",t+1).append(l).append($("<span>").html("&nbsp;×&nbsp;".concat(a.count,"&nbsp;"))).append($("<span>").addClass("spacer")).append($("<a>").addClass("item-action-link").text("give"===r?"给予":"取走").on("click",(function(){var t=parseInt($(this).closest("li").data("slot")),a=e.transfer(n,t-1);a.success||Popup.info("".concat("give"===r?"给予":"获取","失败"),a.message),e.render($(".inventory-transfer-container").parent()[0],n,r,i)}))).append($("<span>").addClass("spacer"));s.append(c)}}));for(var l=$("<li>").addClass("all-listing slot-inventory-listing"),u=0;u<3;u++)l.append($("<span>").addClass("spacer"));l.append($("<a>").addClass("item-action-link").text("".concat("give"===r?"给予":"取走","全部")).on("click",(function(){var t=!1;e.iterate((function(i,a){if(a&&!t){var o=e.transfer(n,i);if(!o.success)return Popup.info("$".concat("give"===r?"给予":"获取","失败"),o.message),t=!0,!1}})),e.render($(".inventory-transfer-container").parent()[0],n,r,i)}))).append($("<span>").addClass("spacer")),s.append(l),o.append(s),$(t).empty().append(o)}(t,this,e,arguments.length>2&&void 0!==arguments[2]?arguments[2]:"give",arguments.length>3&&void 0!==arguments[3]&&arguments[3]):f(t,this)}}()})(),(()=>{function t(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,a,o,s=[],l=!0,u=!1;try{if(a=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=a.call(n)).done)&&(s.push(r.value),s.length!==e);l=!0);}catch(t){u=!0,i=t}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw i}}return s}}(t,e)||r(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(t){return function(t){if(Array.isArray(t))return i(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||r(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=r(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,a=function(){};return{s:a,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){l=!0,o=t},f:function(){try{s||null==n.return||n.return()}finally{if(l)throw o}}}}function r(t,e){if(t){if("string"==typeof t)return i(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(t,e):void 0}}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}!function(){function r(t,e){return t.trim().split(" ")[e].replace(/['"]/g,"").trim()}function i(t,e){return State.getVar(r(t,e))}Macro.add("newinv",{handler:function(){var t=r(this.args.raw,0);if(!function(t){return t&&"string"==typeof t&&t.length>=2&&("$"===t[0]||"_"===t[0])}(t))return this.error("argument must be a story or temporary variable!");var e=clone(Inventory.DefaultOpts);if(null!=this.args[1]){var n=parseInt(this.args[1]);e.maxSlots=isNaN(n)?Inventory.DefaultOpts.maxSlots:n}if(null!=this.args[2]){var i=parseInt(this.args[2]);e.maxStack=isNaN(i)?Inventory.DefaultOpts.maxStack:i}State.setVar(t,new Inventory([],{},e))}}),Macro.add("transfer",{handler:function(){if(this.args.length<3)return this.error("Not enough arguments provided. At least three arguments are required");var t=this.args[0],e=this.args[1],n=parseInt(this.args[2])-1,r=void 0!==this.args[3]?parseInt(this.args[3])-1:null;if(!(t instanceof Inventory&&e instanceof Inventory))return this.error("The first and second arguments must be inventory objects!");if(isNaN(n))return this.error("The third argument must be a valid slot index!");if(null!==r&&isNaN(r))return this.error("The fourth argument must be a valid slot index!");var i=Inventory.StatusCode,a=t.transfer(e,n,r);switch(a.code){case i.SUCCESS:State.length>0&&Popup.success("转移成功","物品已成功转移到目标背包");break;case i.INVALID_SLOT:Popup.error("转移失败","无效的格子索引");break;case i.SLOT_FULL:Popup.info("转移失败","目标格子已满");break;case i.PERMANENT_ITEM:Popup.info("转移失败","".concat(a.item,"无法转移"));break;default:Popup.error("转移失败",a.message)}}}),Macro.add(["store","drop"],{handler:function(){var t,e,n,r=this.args[0],i=Inventory.StatusCode;if(this.args.length<1||!(r instanceof Inventory))return this.error("The first argument must be a inventory!");if(this.args.length<2)return this.error("Not enough arguments provided. At least two arguments are required");var a=null!==(t=this.args[2])&&void 0!==t?t:1;if("drop"!==this.name)r.store(this.args[1],this.args[2],this.args[3],this.args[4]);else{var o=r.drop(this.args[1]-1,a);switch(o.code){case i.INVALID_SLOT:Popup.error("语句错误",o.message);break;case i.PERMANENT_ITEM:Popup.info("操作失败",o.message);break;case i.SUCCESS:Popup.info("操作成功","".concat(null!==(e=null===(n=Item.get(o.item))||void 0===n?void 0:n.displayName)&&void 0!==e?e:o.item,"(x").concat(a,")被丢弃"));break;default:Popup.error("操作失败",o.message)}}}}),Macro.add("delete",{handler:function(){var t=this.args[0],n=Inventory.StatusCode;if(this.args.length<2)return this.error("Not enough arguments provided. At least two arguments are required");if(!(t instanceof Inventory))return this.error("The first argument must be a inventory!");var r=t.delete.apply(t,e(this.args.slice(1)));r.code!==n.SUCCESS?Popup.error("操作失败",r.message):Popup.success("操作成功","物品被删除")}}),Macro.add(["inv","take","give"],{handler:function(){if(this.args.length<1)return this.error("A inventory variable must be specified!");var t=this.args.raw,e=i(t,0);if(function(t){if(!(t instanceof Inventory))throw new Error("The argument must be a inventory object!")}(e),"inv"===this.name)e.render(this.output);else{var n=i(t,1);e.render(this.output,n,this.name)}}}),Macro.add("use",{handler:function(){if(this.args.length<2)return this.error("Not enough arguments provided. At least two arguments are required");var t=i(this.args.raw,0);if(!(t instanceof Inventory))return this.error("The first argument must be a inventory!");var e="string"==typeof this.args[1]?t.indexOf(this.args[1]):this.args[1]-1;if(isNaN(e))return this.error("The second argument must be a valid slot index!");-1!==e?t.use(e):Popup.info("物品不存在","".concat(this.args[1],"不存在于容器中"))}}),Macro.add(["item"].concat(e(AllCategories)),{tags:["description","tags","durability","unstackable","permanent","unique","url","category"],handler:function(){var e,r;if(this.args.length<1)return this.error("Not enough arguments provided. At least one argument is required");var i,a,o,s=this.args[0],l=null!==(e=this.args[1])&&void 0!==e?e:s,u=[],c=0,d="",f="",h=null,v=!1,p=!1,m=!1;if(h=this.payload[0].contents.trim(),this.payload.length>1){var y,g=n(this.payload.slice(1));try{for(g.s();!(y=g.n()).done;){var b=y.value;switch(b.name){case"tags":i=b.args.flat(1/0);break;case"description":f=b.contents.trim();break;case"durability":c=parseInt(null!==(r=b.args[0])&&void 0!==r?r:0);break;case"unstackable":v=!0;break;case"permanent":p=!0;break;case"unique":m=!0;break;case"url":d=b.args.raw;break;case"category":u=b.args}}}catch(t){g.e(t)}finally{g.f()}}if("item"===this.name){0===u.length&&u.push("misc"),1===u.length&&u.push("other");var S=t(u,2);a=S[0],o=S[1]}else{var C=t(category(this.name),2);a=C[0],o=C[1]}Item.add(s,{displayName:l,description:f,stackable:!v&&0===c,durability:c,handler:h,permanent:p,unique:m,cat:a,sub:o,url:d},i)}})}()})();
/* End Slot Inventory */